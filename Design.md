# 设计过程

根据 (这里)[https://github.com/xmindltd/hiring/blob/master/frontend-1/README.md] 的需求

这个应用可以分成几个部分:

- 后端

  - 读取和保存 csv
  - 把数据封装成接口

- 前端

  - 账单列表
  - 添加账单的表单
  - 筛选栏
  - 统计栏

因为是前端大作业，所以我决定对后端只做一点简单的封装

## 后端部分

后端需要提供的接口有 3 个，分别是：

- GET /bills : 获取所有账单数据
- POST /bills : 新增账单接口
- GET /categories : 获取所有账单分类数据

因为数据需要持久化到 csv 文件里，为了避免文件锁导致服务异常，所以加了一个 debounce 方法，在空闲的时候同步 csv 文件和后端服务内存中的数据

然后简单的把数据封装成接口，等待前端调用

## 前端部分

### 组件拆分

前端主要显示一个单独的页面:

- BillList: 账单列表

并且封装一个显示单行数据的组件:

- BillListItem

然后根据要求，给账单列表加入组件，包括：

- Filters: 筛选框部分，用于筛选 BillList 中显示的数据；其中，账单分类需要根据已选的月份中剩余的账单数据显示可选内容
- Form: 添加新账单的表单
- Statistics: 统计部分，根据需求显示统计数据

### Store 部分

数据通过 [service](src/service.ts) 中提供的方法请求 API 获取，`service` 封装了 `axios`

获取到的数据，通过 React 的 Context API 在组件之间共享，Context 的设计与 API 相对应，包括：

- setBills: 更新内存中所有的账单
- SetCategories: 更新内存中所有的账单分类
- AddBill: 添加一条账单记录

为了减少请求的次数，在客户端添加数据和请求后端接口添加数据是并行的，但因为时间关系没有处理事务一致性的问题（不会根据请求的结果 retry）

### 实现中遇到的问题

- 由于文档中说明`bill.category`不是必须的，所以虽然数据中`category`数据没有空缺，还是给它设置了一个 fallback 值`其他`。并且在新增，筛选，统计当中都支持显示
- 将要做完的时候突然明白了`category`为什么需要`type`，所以在表单中加入了级联的功能
- 账单金额还是用以分为单位的整数比较让人放心
- 粗略的做了一些样式
- 大概用了 5 ~ 6 个小时左右完成这个作业
